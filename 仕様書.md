# TOEFL文法ガイド 和訳トグル機能 仕様書

## 1. 機能概要

- 英文の直後に書かれた**全角山括弧 `＜…＞` の日本語訳**を、タップ（クリック）で表示／非表示できるようにする。
- **全角丸括弧 `（…）` 内の日本語は常に表示**し、トグル対象にはしない。

## 2. 対象範囲

- `mymyEN/index.html` 内の「TOEFL文法完全ガイド」コンテンツ。
- ただし、実際にトグル対象となるのは次の条件を満たす行のみ。
  - HTML要素が `<p>` または `<li>`。
  - テキスト末尾に「全角山括弧 `＜…＞` で囲まれた日本語」がある。
  - 山括弧より前の部分に、英字（A–Z / a–z）が少なくとも 1 文字含まれている。

## 3. 表示仕様

- 初期表示
  - 英文のみ表示される。
  - `＜…＞` 内の日本語訳は非表示。
  - `（…）` 内の日本語は常に表示（既存の注釈や補足訳など）。

- 表示状態の切り替え
  - 対象行の英文部分は、押せる見た目のブロック要素（`translation-sentence`）として表示。
  - ユーザーがクリック／タップすると、その直下の日本語訳（`translation-text`）が表示される。
  - 再度クリック／タップで、日本語訳は非表示に戻る。

- アクセシビリティ
  - 英文部分に `role="button"` を付与し、`Enter`・`Space` キーで表示／非表示を切り替え可能。
  - 状態は `aria-expanded="true|false"` で管理。
  - 日本語訳側には `aria-hidden="true|false"` を付与。

## 4. マークアップルール（執筆時の書き方）

- トグルさせたい例文の書き方（Markdown 例）
  - 箇条書き:  
    `- This book was written by Shakespeare.＜この本はシェイクスピアによって書かれた。＞`
  - 表のセル:  
    `The room is cleaned every day.＜その部屋は毎日掃除される。＞`

- ルール
  - `＜…＞` は**行末**に置く（後ろに別の文字を続けない）。
  - `＜…＞` の中身には、日本語（ひらがな・カタカナ・漢字）を含める。
  - 丸括弧 `（…）` を使った既存の日本語は、そのまま常時表示テキストとして残す。

## 5. 振る舞いの詳細（ロジック概要）

- 対象抽出
  - 各 `<p>` / `<li>` のテキスト末尾を正規表現でチェック。
  - パターン（概念）：  
    - 「行末の `＜…＞`」  
    - 中身 `…` に少なくとも 1 文字以上の日本語が含まれる場合のみ対象。

- DOM 変換
  - 元テキスト:  
    `英文……＜日本語訳……＞`
  - 変換後:
    ```html
    <span class="translation-sentence" tabindex="0" role="button" aria-expanded="false">
      英文……
    </span>
    <div class="translation-text" hidden aria-hidden="true">
      日本語訳……
    </div>
    ```
  - `translation-text` は初期状態で `hidden`（非表示）。

- イベント処理
  - `translation-sentence` にクリックリスナーとキーイベント（Enter / Space）を設定。
  - 実行時に以下をトグル:
    - `aria-expanded="false" ⇔ "true"`
    - 対応する `translation-text.hidden = true ⇔ false`
    - `aria-hidden="true" ⇔ "false"`

## 6. デザイン仕様（要点）

- 英文部分（`.translation-sentence`）
  - ブロック表示、軽い背景色、下線（破線）で「押せる要素」であることを表現。
  - ホバー／フォーカス時に背景とボーダー色を変更し、アクティブであることを強調。

- 日本語訳部分（`.translation-text`）
  - 英文のすぐ下に表示。
  - 薄い背景色と左ボーダーで「解説・訳」であることを視覚的に明示。
  - ダークモード時には背景色とボーダー色をダークテーマ用に変更。

